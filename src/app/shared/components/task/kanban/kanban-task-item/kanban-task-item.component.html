<div
  [dndDraggable]="task"
  [dndEffectAllowed]="'move'"
  (dndStart)="onDragStart($event)"
  (dndEnd)="onDragEnd($event)"
  class="relative p-5 bg-white border border-gray-200 task rounded-xl shadow-theme-sm dark:border-gray-800 dark:bg-white/5">
      <div class="space-y-4">
        <div>
          <h4 class="mb-5 mr-10 text-base text-gray-800 dark:text-white/90">
            {{ task.title }}
          </h4>
          @if (task.projectDesc) {
          <p class="text-sm text-gray-500 dark:text-gray-400">
            {{ task.projectDesc }}
          </p>
          }
          <div class="flex items-center gap-2 mt-2">
            <span class="inline-flex rounded-full px-2 py-0.5 text-theme-xs font-medium bg-green-100 text-green-700 dark:bg-green-500/15 dark:text-green-400">Aprovados: {{ getApprovedCount() }}</span>
            <span class="inline-flex rounded-full px-2 py-0.5 text-theme-xs font-medium bg-orange-100 text-orange-700 dark:bg-orange-500/15 dark:text-orange-400">Candidatos: {{ getPendingCount() }}</span>
          </div>
        </div>
      </div>
      <button (click)="toggleExpand()" class="absolute top-5 right-5 flex items-center justify-center w-6 h-6 rounded-full border border-gray-200 bg-white text-gray-600 hover:text-gray-800 dark:border-gray-800 dark:bg-gray-700 dark:text-gray-300">
        <svg class="size-4" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M12 5C7 5 3.73 8.11 2 12C3.73 15.89 7 19 12 19C17 19 20.27 15.89 22 12C20.27 8.11 17 5 12 5Z" stroke="currentColor" stroke-width="1.5"/>
          <path d="M12 15C13.6569 15 15 13.6569 15 12C15 10.3431 13.6569 9 12 9C10.3431 9 9 10.3431 9 12C9 13.6569 10.3431 15 12 15Z" stroke="currentColor" stroke-width="1.5"/>
        </svg>
      </button>

      @if (task.expanded) {
      <div class="mt-4 space-y-4">
        <div class="flex items-center gap-2">
          <div class="flex -space-x-2">
            @for (u of getApprovedUsers(); track u.id) {
            <img [src]="getUserAvatar(u)" class="size-7 rounded-full border border-gray-200 dark:border-gray-700" alt="user"/>
            }
          </div>
        </div>
        <div class="space-y-1">
          @for (item of getApprovedUsersDetailed(); track item.user.id) {
          <div (click)="onApprovedClick(item.bucket, item.user)" class="flex items-center gap-2 px-2 py-1 rounded-md cursor-pointer hover:bg-red-100 dark:hover:bg-red-500/10">
            <img [src]="getUserAvatar(item.user)" class="size-6 rounded-full border border-green-300" alt="user"/>
            <span class="text-sm text-gray-700 dark:text-gray-300">{{ getUserName(item.user) }}</span>
            <span class="ml-auto text-xs text-gray-500 dark:text-gray-400">{{ getInstrumentShort(item.instrument) }}</span>
            <span class="ml-2 text-xs text-green-600">
              <svg width="1em" height="1em" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="text-success-500">
                <path d="M13.4017 4.35986L6.12166 11.6399L2.59833 8.11657" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"></path>
              </svg>
            </span>
          </div>
          }
        </div>
        <div class="space-y-3">
          @for (bucket of (task.song?.instrument_buckets || []); track bucket.instrument) {
          <div class="space-y-2">
            <div class="text-sm font-medium text-gray-800 dark:text-white/90">{{ getInstrumentRemainingLabel(bucket) }}</div>
            <div class="space-y-1">
              @for (user of (bucket.pending || []); track user.id) {
              <button (click)="onCandidateClick(bucket, user)" class="flex items-center gap-2 w-full text-left px-2 py-1 rounded-md hover:bg-gray-100 dark:hover:bg-white/10">
                <img [src]="getUserAvatar(user)" class="size-6 rounded-full border border-gray-200 dark:border-gray-700" alt="user"/>
                <span class="text-sm text-gray-700 dark:text-gray-300">{{ getUserName(user) }}</span>
              </button>
              }
              @for (user of (bucket.approved || []); track user.id) {
              <div (click)="onApprovedClick(bucket, user)" class="flex items-center gap-2 px-2 py-1 rounded-md cursor-pointer hover:bg-red-100 dark:hover:bg-red-500/10">
                <img [src]="getUserAvatar(user)" class="size-6 rounded-full border border-green-300" alt="user"/>
                <span class="text-sm text-gray-700 dark:text-gray-300">{{ getUserName(user) }}</span>
                <span class="ml-auto text-xs text-green-600">
                  <svg width="1em" height="1em" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="text-success-500">
                    <path d="M13.4017 4.35986L6.12166 11.6399L2.59833 8.11657" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"></path>
                  </svg>
                </span>
              </div>
              }
            </div>
          </div>
          }
        </div>
      </div>
      }
    </div>